<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>join</title>
    <link rel="stylesheet" href="/css/user/join.css">
</head>
<body>
<!-- 헤더 시작-->
<header class="header" th:replace="fragments/header :: header"></header>
<!-- 헤더 종료-->
    <!-- 메인 시작-->
    <div class="main-container">
        <div class="main-nav-container">
     
        </div>
        <div class="main-content">
            <div class="main-content-contaniner">
                <div class="main-content-title">회원가입</div>
                
                <form class="content-box" action="/user/join" method="post" name="joinForm">
                    <div class="main-container-section1">
                        <div class="input-name">아이디</div>
                        <div>
                            <input class="inputid" type="text" placeholder="아이디"
                            id="userId" name="userId" required/>
                            <button type="button" class="btn-auth" id="confirm-id"
                                    name="confirm-id" value="유효한 아이디 확인 검증">확인</button>
                        </div>
                        <span class="check-id"></span><!--CSS로 색변경 유도-->
                        <br>
                        <div class="input-name">비밀번호</div>
                        <input class="inputpw" type="password"
                               placeholder="8~12자 영문 대,소문자 각각 한 글자 이상 포함하여 주세요."
                        id="userPassword" name="userPassword" required><br>
                        <div class="input-name">비밀번호확인</div>
                        <input class="inputpw2" type="password" placeholder="비밀번호확인"
                        id="confirm-password" name="confirm-password" required><br>
                        <div class="input-name">이름</div>
                        <input class="inputname" type="test" placeholder="이름"
                        id="userName" name="userName" required><br>
                        <div class="input-name">이메일</div>
                        <input class="inputemail" type="email" placeholder="이메일"
                        id="userEmail" name="userEmail" required><br>
<!--===============================================================================================-->
                        <div class="input-name">휴대전화</div>
                        <div>
                            <input class="inputphone" type="text" placeholder="휴대폰 번호 입력"
                            id="userPhone" name="userPhone" required>
                            <button type="button" class="btn-auth" id="startTimer"
                                    name="numberAuth" value="휴대폰 인증 문자 전송">전송</button>
                        </div>

                        <!--=========-->
                        <div class="inputresult">테스트 테스트 테스트 테스트</div>
                        <!--=========-->
                        <br>
                        <div class="main-c-s-d1">
                            <input class="phone-auth" type="text" placeholder="인증번호를 입력해주세요."
                                   id="inputNum" name="authNumber" required/>
                            <div class="main-time" id="time"></div>
                            <button class="btn-auth" type="button" id="checkNum">인증</button>
                        </div>

                        <br>
<!--===============================================================================================-->
                        <div class="input-name">생년월일</div>
                        <div class="info" id="info__birth">
                            <select class="box" id="birth-year" required>
                            <option disabled selected  >출생 연도</option>
                            </select>
                            <select class="box" id="birth-month" required>
                            <option disabled selected >월</option>
                            </select>
                            <select class="box" id="birth-day" required>
                            <option disabled selected >일</option>
                                <input type="hidden" id="userBirth" name="userBirth" required/>
                            </select>

                        </div><br>
                        <div class="input-name">성별</div>
                        <div class="radio-gender">
                            <label for="gender-m" style="cursor: pointer;">
                                <input type='radio' name='userGender' value='M'
                                id="gender-m" required/>남
                            </label>
                            <label for="gender-f" style="cursor: pointer;">
                                <input type='radio' name='userGender' value='F'
                                id="gender-f" required/>여
                            </label>
                        </div>

                    </div>
                    <div class="main-container-section2"><br> 
                        <div class="input-name2">약관 동의</div>
                            <div class="checkbox-agree0">
                                <label for="total-check" style="cursor: pointer;">
                                    <input type="checkbox" value="false" class="section2-checkbox" id="total-check" >
                                    <p class="span-p">전체동의</p><br><br>
                                </label>
                            </div>

<!-- 모달창1 시작 -->
                            
                            <section class="none terms-modal"> 
                                <div class="modal">
                                    <div th:replace="fragments/terms :: terms"></div>
                                </div>
                                <div class="inputresult" style="display: none;"></div>
                            </section>
                            <div class="checkbox-agree">
                                <input type="checkbox" value="false" class="main-checkbox" name="check-terms" required>
                                <button type="button" class="btn-open-popup" style="cursor: pointer;">이용약관<p class="span-p">(필수)</p></button>
                            </div>
                            
<!-- 모달창1 끝 -->
<!-- 모달창2 시작-->
                            <section class="none privacy-modal">
                                <div class="modal">
                                    <div th:replace="fragments/privacy :: privacy"></div>
                                </div>
                            </section>
                            <div class="checkbox-agree">
                                <input type="checkbox" value="false" class="main-checkbox" name="check-privacy" required>
                                <button type="button" class="btn-open-popup2" style="cursor: pointer;">개인정보수집 및 이용동의<p class="span-p">(필수)</p></button>
                            </div>
                            <!-- 모달창2 끝-->
                    </div>
                    
                    <div class="main-container-section3">
<!--                        <button class="btn-join" type="submit" onclick="Validation()">회원가입</button>-->
                        <button class="btn-join" type="button" onclick="Validation()" id="join-btn">회원가입</button>
                    </div>
                    <div class="main-container-section4">
                        <a href="/user/login">이미 아이디가 있으신가요? <u>로그인</u></a>
                    </div>
                </form>

            </div>
        </div>
    </div>
    <!-- 메인 끝-->
<!-- 후터 시작-->
<footer class="footer" th:replace="fragments/footer :: footer"></footer>
<!-- 후터 끝-->
    <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <script src="/js/user/join.js"></script>

<script>
    /*===문자 인증 관련 js 시작===*/
    $('#checkNum').on('click', function () {
        let checkNumber = $('#inputNum').val();
        let inputphone = $('.inputphone').val();

        // 인증번호와 휴대전화 입력값이 모두 비어있으면 인증 버튼 비활성화
        if (checkNumber.trim() === '' || inputphone.trim() === '') {
            document.getElementById('join-btn').disabled = true;
            return;
        }

        let param = {
            checkNumber: checkNumber
        }

        $.ajax({
            url: '/sms/v1/msgCheck',
            type: 'post',
            data: JSON.stringify(param),
            contentType: 'application/json; charset=utf-8',
            success: function (result) {
                console.log(result);

                $('.inputresult').text(result);

                if (result == "인증이 완료되었습니다.") {
                    $('.main-time').css('display', 'none');
                    document.getElementById('join-btn').disabled = false;
                }
            }
        });
    });

    // 휴대전화 인증 시작 버튼 클릭 이벤트를 처리하는 부분
    $('#startTimer').on('click', function () {
        let userPhone = $('.inputphone').val();

        // 휴대전화 입력값이 비어있으면 인증 버튼 비활성화
        if (userPhone.trim() === '') {
            document.getElementById('join-btn').disabled = true;
            return;
        }

        $.ajax({
            url: '/sms/v1/msgSend',
            type: 'post',
            data: JSON.stringify({ userPhone: userPhone }),
            contentType: 'application/json; charset=utf-8',
            success: function () {
                $('.inputresult').css('display', 'flex');
                $('.inputresult').text("입력하신 번호로 인증번호가 발송되었습니다.");
                document.getElementById('join-btn').disabled = true;
            }
        });

        // 타이머 js
        var time = 300; // 기준시간 작성
        var min = ""; // 분
        var sec = ""; // 초

        var x = setInterval(function () {
            min = parseInt(time / 60);
            sec = time % 60;

            document.getElementById("time").innerHTML = min + "분" + sec + "초";
            time--;

            if (time < 0) {
                clearInterval(x);
                document.getElementById("time").innerHTML = "시간초과";
            }
        }, 1000);
    });
    //userPhone : 가입자의 폰번호, checkNumber : 가입자가 입력한 인증번호
    /*===문자 인증 관련 js 종료===*/
</script>

</body>
</html>